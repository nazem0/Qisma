<div class="">
  <p-dropdown
    [optionLabel]="'name'"
    [options]="orderStatusArray"
    placeholder="Filter By Order Status"
    (onChange)="resetPage(); getOrders($event.value.id)"
    (onClear)="resetPage(); getOrders()"
    styleClass="w-100"
    [showClear]="true"
  ></p-dropdown>
  <p-table
    [value]="orders ?? []"
    [rows]="pagination.size"
    [totalRecords]="pagination.total"
    [tableStyle]="{ 'min-width': '50rem' }"
  >
    <ng-template pTemplate="header">
      <tr>
        <th>User Information</th>
        <th>Order Financial Details</th>
        <th>Property Details</th>
        <th>Status</th>
        <th>PDF</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-order>
      <tr>
        <td>
          <p-accordion>
            <p-accordionTab
              [header]="
                order.userInformation.firstName +
                ' ' +
                order.userInformation.middleName
              "
            >
              <div>UserID: {{ order.userInformation.userId }}</div>
              <div>
                Name: {{ order.userInformation.firstName }}
                {{ order.userInformation.middleName }}
                {{ order.userInformation.lastName }}
              </div>
              <div>
                DOB:
                {{ order.userInformation.dateOfBirth | date : "mediumDate" }}
              </div>
              <div>Address: {{ order.userInformation.address }}</div>
              <div>
                Occupation: {{ order.userInformation.occupation }} at
                {{ order.userInformation.companyName }}
              </div>
              <div>Investor Type: {{ order.userInformation.investorType }}</div>
              <div>Phone: {{ order.userInformation.phoneNumber }}</div>
              <div>Email: {{ order.userInformation.email }}</div>
            </p-accordionTab>
          </p-accordion>
        </td>
        <td>
          <p-accordion>
            <p-accordionTab
              [header]="order.orderFinancialDetails.numberOfShares + ' Shares'"
            >
              <div>Order ID: {{ order.orderFinancialDetails.orderId }}</div>
              <div>
                Order Number: {{ order.orderFinancialDetails.orderNumber }}
              </div>
              <div>
                Transaction Fees:
                {{ order.orderFinancialDetails.transactionFees | currency }}
              </div>
              <div>
                Shares: {{ order.orderFinancialDetails.numberOfShares }}
              </div>
              <div>
                Share Price:
                {{ order.orderFinancialDetails.sharePrice | currency }}
              </div>
              <div>
                Down Payment:
                {{ order.orderFinancialDetails.downPayment | currency }}
              </div>
              <div>
                Monthly Installment:
                {{ order.orderFinancialDetails.monthlyInstallment | currency }}
              </div>
              <div>Years: {{ order.orderFinancialDetails.numberOfYears }}</div>
              <div>
                Maintenance Installment:
                {{
                  order.orderFinancialDetails.maintenaceInstallment | currency
                }}
              </div>
              <div>
                Delivery Installment:
                {{ order.orderFinancialDetails.deliveryInstallment | currency }}
              </div>
              <div>
                Order Date:
                {{
                  order.orderFinancialDetails.orderDate | date : "mediumDate"
                }}
              </div>
              <div *ngIf="order.orderFinancialDetails.confirmationDate">
                Confirmation Date:
                {{
                  order.orderFinancialDetails.confirmationDate
                    | date : "mediumDate"
                }}
              </div>
            </p-accordionTab>
          </p-accordion>
        </td>
        <td class="td-min-width-15">
          <p-accordion>
            <p-accordionTab [header]="order.property.address">
              <!-- <ng-template pTemplate="header">
                <div class="d-flex justify-content-between align-items-center gap-2">
                  <div>
                    <img class="property-image-preview rounded-circle" [src]="helper.processFileUrl(order.property.imageUrl)" alt="Property Image">
                  </div>
                  <span>
                    {{order.property.address}}
                  </span>
                </div>
              </ng-template> -->
              <div class="d-flex justify-content-center mb-2">
                <img class="property-image-preview rounded-circle" [src]="helper.processFileUrl(order.property.imageUrl)" alt="Property Image">
              </div>
              <hr>
              <div>Property ID: {{ order.property.propertyId }}</div>
              <div>Address: {{ order.property.address }}</div>
              <div>City: {{ order.property.city }}</div>
              <div>
                Annual Return: {{ order.property.projectedAnnualReturn }}%
              </div>
              <div>
                Rental Yield: {{ order.property.projectedRentalYield }}%
              </div>
              <div>Token Price: {{ order.property.tokenPrice | currency }}</div>
              <div>Available Tokens: {{ order.property.availableTokens }}</div>
            </p-accordionTab>
          </p-accordion>
        </td>
        <td>
          <p-accordion>
            <p-accordionTab [header]="order.orderStatusName">
              <div>
                Order Date:
                {{
                  order.orderFinancialDetails.orderDate | date : "mediumDate"
                }}
              </div>
              <div *ngIf="order.orderFinancialDetails.confirmationDate">
                Confirmation Date:
                {{
                  order.orderFinancialDetails.confirmationDate
                    | date : "mediumDate"
                }}
              </div>
              @if (order.orderStatus != 2) {
              <div class="d-flex gap-2 justify-content-center mt-2">
                <p-button
            [raised]="true"
            [severity]="'success'"
            (onClick)="confirmOrRejectOrder(order.orderFinancialDetails.orderId, true)"
          >
            <span class="text-white mx-auto">
              <i class="pi pi-check"></i>
            </span>
          </p-button>
                <p-button
            [raised]="true"
            [severity]="'danger'"
            (onClick)="confirmOrRejectOrder(order.orderFinancialDetails.orderId, false)"
          >
            <span class="text-white mx-auto">
              <i class="pi pi-times"></i>
            </span>
          </p-button>
              </div>
            }
            </p-accordionTab>
          </p-accordion>
        </td>
        <td>
          <div class="mt-2">
            <a [href]="helper.processOrderPdfFileUrl(order.orderPdfUrl)">
              <i class="pi pi-file-pdf fs-1"></i>
            </a>
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>

  <div class="text-center my-3">
    <div class="spinner" [ngClass]="{ hidden: !orders }"></div>
    <nz-pagination
      [nzPageIndex]="2"
      [nzTotal]="500"
      nzShowQuickJumper
      nzShowSizeChanger
      [nzPageSizeOptions]="[12, 18, 24]"
      [nzPageSize]="pagination.size"
      [nzPageIndex]="pagination.index"
      [nzTotal]="pagination.total"
      (nzPageIndexChange)="getPage($event)"
      [(nzPageSize)]="pagination.size"
      (nzPageSizeChange)="getOrders()"
      [nzPageIndex]="pagination.index + 1"
    ></nz-pagination>
  </div>
</div>
